<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–º–µ—Ç–∫–∏</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<header class="header">
    <h1>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h1>
</header>

<main class="container">

    <div class="notes-grid">
        <div class="note-card" th:each="note : ${notes}"
            th:data-id="${note.id}"
            th:data-title="${note.title}"
            th:data-content="${note.payload}">

            <h2 th:text="${note.title}">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
            <p th:text="${note.payload}">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</p>
        </div>
    </div>

    <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø -->
    <div class="pagination">

        <!-- –ù–∞–∑–∞–¥ -->
        <a
                th:if="${!isFirst}"
                th:href="@{/{userId}/notes(userId=${userId}, page=${page - 1}, pageSize=${pageSize})}"
                class="page-btn">
            ‚Üê –ù–∞–∑–∞–¥
        </a>

        <span class="page-info">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${page + 1}">1</span>
        </span>

        <!-- –í–ø–µ—Ä—ë–¥ -->
        <a
                th:if="${!isLast}"
                th:href="@{/{userId}/notes(userId=${userId}, page=${page + 1}, pageSize=${pageSize})}"
                class="page-btn">
            –í–ø–µ—Ä—ë–¥ ‚Üí
        </a>

    </div>

    <!-- –ö–ù–û–ü–ö–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø -->
    <button class="add-note-btn" onclick="toggleForm()">+</button>

    <!-- –§–û–†–ú–ê –°–û–ó–î–ê–ù–ò–Ø -->
    <div id="noteForm" class="note-form hidden">
        <form th:action="@{/{userId}/notes(userId=${userId})}" method="post">
            <h3>–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</h3>

            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}">

            <input type="text"
                   name="title"
                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
                   required />

            <textarea name="payload"
                      placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ"
                      rows="5"
                      required></textarea>

            <div class="form-actions">
                <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
                <button type="button" onclick="toggleForm()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>

    <!-- VIEW MODAL -->
    <div id="noteModal" class="modal hidden">
        <div class="modal-content">

            <!-- VIEW MODE -->
            <div id="viewMode" class="view-mode">
                <h2 id="viewTitle" class="note-title"></h2>
                <p id="viewContent" class="note-content"></p>

                <div class="note-actions">
                    <button id="editBtn" class="btn primary">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>

                    <form id="deleteForm" method="post">
                        <input type="hidden" name="_method" value="delete">
                        <input type="hidden"
                               th:name="${_csrf.parameterName}"
                               th:value="${_csrf.token}">
                        <button type="submit" class="btn danger">
                            üóë –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </div>
            </div>

            <!-- EDIT MODE -->
            <div id="editMode" class="edit-mode hidden">
                <form id="editForm" method="post">

                    <input type="hidden" name="_method" value="put">
                    <input type="hidden" name="id" id="editId">
                    <input type="hidden"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}">

                    <div class="field">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="title" id="editTitle" required>
                    </div>

                    <div class="field">
                        <label>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</label>
                        <textarea name="payload"
                                  id="editContent"
                                  rows="6"
                                  required></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">
                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        <button type="button" id="cancelEdit" class="btn ghost">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>

                </form>
            </div>


        </div>
    </div>



</main>


<script>
    const USER_ID = "[[${userId}]]";
</script>
<script th:src="@{/js/script.js}"></script>
</body>
</html>
